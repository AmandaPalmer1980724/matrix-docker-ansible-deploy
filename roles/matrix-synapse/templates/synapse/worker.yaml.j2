#jinja2: lstrip_blocks: "True"
worker_app: synapse.app.{{ matrix_synapse_worker_details.type }}
worker_name: {{ matrix_synapse_worker_details.type ~ ':' ~ matrix_synapse_worker_details.port }}

worker_replication_host: matrix-synapse
worker_replication_http_port: {{ matrix_synapse_replication_http_port }}

worker_listeners:
{% if matrix_synapse_worker_details.type not in [ 'appservice', 'federation_sender', 'pusher' ] %}
  - type: http
    port: {{ matrix_synapse_worker_details.port }}
    resources:
      - names:
{% if matrix_synapse_worker_details.type in [ 'generic_worker', 'frontend_proxy', 'user_dir' ] %}
        - client
{% endif %}
{% if matrix_synapse_worker_details.type in [ 'generic_worker' ] %}
        - federation
{% elif matrix_synapse_worker_details.type in [ 'media_repository' ] %}
        - media
{% endif %}

{% endif %}
  - type: metrics
    bind_address: ['127.0.0.1']
    port: {{ matrix_synapse_worker_details.metrics_port }}

{% if matrix_synapse_worker_details.type == 'frontend_proxy' %}
worker_main_http_uri: http://matrix-synapse:8008
{% endif %}

worker_daemonize: false
worker_log_config: /data/{{ matrix_server_fqn_matrix }}.log.config
